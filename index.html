<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Ditboc</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">

    <link rel="stylesheet" href="css/main.css">

</head>

<body>
    <data>        
         <table id="menuTable"></table>
         <table id="pageContentTable"></table>
    </data>

    <nav class="navbar navbar-default">
    <div class="container-fluid">
            <ul id="menu" role="navigation" class="nav navbar-nav">
           <script id="menuitem-template" type="text/x-handlebars-template">
                {{#each menuItem}}
                    <li>
                      <a href="?page={{ID}}">{{NAME}}</a>
                    </li>
                {{/each}}
            </script>
        </ul>
    </div>
   
    </nav>

   
  

    <main>
        <div class="container">
            <header>
                <script type="text/x-handlebars-template" id="contenttitle-template">
                    <h1>
                        {{TEXT}}
                    </h1>
                </script>      
            </header>
        </div>
    </main>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="https://chriszarate.github.io/sheetrock/dist/jquery.sheetrock.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/1.1.2/handlebars.min.js"></script>
    <script src="js/jquery.tabletojson.js"></script>
    
    <script type=text/javascript>
        var spreadSheet = 'https://docs.google.com/spreadsheets/d/1PAS_OmAgq9SmkYTr-eNcBsPrGpDuF9DWOguKlIl3yh8#gid=0';

        function getUrlParameter(sParam) {
            var sPageURL = window.location.search.substring(1);
            var sURLVariables = sPageURL.split('&');
            for (var i = 0; i < sURLVariables.length; i++) {
                var sParameterName = sURLVariables[i].split("=");
                if (sParameterName[0] == sParam) {
                    return sParameterName[1];
                }
            }
        }
      
        // function PopulateTemplate(datatable, target, template) {
        // // console.log(datatable);
        // // console.log(target);
        // // console.log(template);  
        // console.log(datatable); 
        //     var menuTable = $('#menuTable').tableToJSON();
        //     var source = $('#menuitem-template').html();
        //     var template = Handlebars.compile(source);
        //     var context = {menuItem: menuTable};
        //     var html = template(context);
        //     $('#menu').append(html);

        //     console.log(html);
        //     return null;
        // };


        function PopulateTemplate(datatable, template, target) {
         
                console.log(datatable);
                console.log(target);
                console.log(template);  
       
            var menuTable = datatable.tableToJSON();
            var source = template.html();
            var template = Handlebars.compile(source);
            var context = {menuItem: menuTable};
            var html = template(context);
            target.append(html);
        };

        $('#menuTable').sheetrock({
            url: spreadSheet,
            sql: 'select %ID%, %NAME%',
            chunkSize: 5,
            userCallback: function(){PopulateTemplate($('#menuTable'), $('#menuitem-template'), $('#menu'))}
        });

        if(getUrlParameter('page') != null) {

            var getPageContent = function() {
                var pageContentTable = $('#pageContentTable').tableToJSON();
                var titleSource = $('#contenttitle-template').html();
                var titleTemplate = Handlebars.compile(titleSource);
                var context = {pageContent: pageContentTable};
                var titleHtml = titleTemplate(context);
                console.log(context);
                $('main h1').append(titleHtml);

            };

            $('#pageContentTable').sheetrock({
                    url: spreadSheet,
                    sql: 'select %TEXT% where %ID% = ' + getUrlParameter('page'),
                    chunkSize: 5,
                    userCallback: getPageContent
                });
        }
        

    
    </script>


</body>

</html>