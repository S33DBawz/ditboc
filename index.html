<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Ditboc</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">

    <link rel="stylesheet" href="css/main.css">

</head>

<body>
    <data>        
         <table id="menuTable"></table>
         <table id="pageComponentsTable"></table>
    </data>
    
    <div id="nav"></div>

   
  

    <main>
        <div class="container">
          
        </div>
    </main>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="https://chriszarate.github.io/sheetrock/dist/jquery.sheetrock.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/1.1.2/handlebars.min.js"></script>
    <script src="js/jquery.tabletojson.js"></script>
    
    <script type=text/javascript>
        var spreadSheet = 'https://docs.google.com/spreadsheets/d/1PAS_OmAgq9SmkYTr-eNcBsPrGpDuF9DWOguKlIl3yh8#gid=0';
        $.fn.sheetrock.options.url = spreadSheet;
        $.fn.sheetrock.options.chunkSize = 25;

        function getUrlParameter(sParam) {
            var sPageURL = window.location.search.substring(1);
            var sURLVariables = sPageURL.split('&');
            for (var i = 0; i < sURLVariables.length; i++) {
                var sParameterName = sURLVariables[i].split("=");
                if (sParameterName[0] == sParam) {
                    return sParameterName[1];
                }
            }
        }
    
        function PopulateTemplate(datatable, template, target) {
            var tableData = datatable.tableToJSON();
            var source = template.html();
            var template = Handlebars.compile(source);
            var context = {item: tableData};
            var html = template(context);
            target.append(html);
        };
   
        function GetCompenent(target, componentName) {
            $.get('components/editorial-managed/'+ componentName +'.html').success(function(data){target.append(data)}
        )};

        function GetPageComponenents(id){
            $('#pageComponentsTable').sheetrock({
                sql: "Select %COMPONENTS% where %ID% = " + id,
                userCallback: function(){
                    var pageComponents = $('#pageComponentsTable').tableToJSON();
                    var componentCollection = pageComponents[0].COMPONENTS;

                    var lbSplitCollection = componentCollection.split("\n");

                    for(var i=0; i < lbSplitCollection.length; i++) {
                        var rowCompenents = lbSplitCollection[i].split(',');
                        $('main > .container').append('<div class="row" data-id="'+ i +'"></div>');
                        var latestRow = $('main > .container > .row[data-id="'+ i +'"]');

                        for(var j=0; j < rowCompenents.length; j++){
                            var componentName = rowCompenents[j].trim();   
                            var colSize = 12 / rowCompenents.length;
                            latestRow.append('<div class="col-md-' + colSize +'" data-component="'+ j +'" data-row="'+ i +'"></div>');
                            var latestCol = $('[data-component="'+ j +'"][data-row="'+ i +'"]');
                            console.log(latestCol);    
                            GetCompenent(latestCol, componentName);                                     
                           
                        }
                    }
                 
                }
            });
        };     

        $.get('components/layout-managed/navbar-default.html').success(function(data){
            $('#nav').html(data);
        });

        if(getUrlParameter('page') != null) {            
            GetPageComponenents(getUrlParameter('page'));

        } else {
            GetPageComponenents(1)
        }
    
    </script>
</body>
</html>